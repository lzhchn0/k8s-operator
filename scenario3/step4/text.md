# Build a framework of operator for redis-cluster


- Operator generated by kubebuilder

```shell
mkdir operator; cd operator
```{{exec}}

- to clear old files
```shell
rm  internal/controller/monitoring_controller.go
rm  api/v1/monitoring_types.go

```{{exec}}


- to rename files after upload files
```shell
mv  "internal/controller/monitoring_controller*.go"    "internal/controller/monitoring_controller.go"
mv  api/v1/monitoring_types*.go   api/v1/monitoring_types.go

```{{exec}}


To apply first CRD and first 'Monitoring'
```shell
k apply -f config/crd/bases/rediscluster.opencanon.io_monitorings.yaml
k apply -f config/samples/rediscluster_v1_monitoring.yaml
```{{exec}}


```shell

```{{exec}}


```shell

```{{exec}}


```shell

```{{exec}}


```shell
go clean -cache
go clean -modcache 
go mod tidy 
go build
```{{exec}}

```shell
k apply -f config/samples/rediscluster_v1_monitoring.yaml
```{{exec}}

> kubebuilder 4.1.1, go 1.21.4
```shell
kubebuilder init  --domain opencanon.io  --plugins=go/v4   --repo blabla.com
```{{exec}}

> kubebuilder 2.0.1, go 1.14
```shell
kubebuilder init   --domain opencanon.io   --repo blabla.com
```{{exec}}


```shell
kubebuilder create api \
  --kind Monitoring\
  --group rediscluster \
  --version v1 \
  --resource true \
  --controller true
```{{exec}}


```shell
make manifests
```{{exec}}



```shell
make install
```{{exec}}


```shell
make run
```{{exec}}


```shell
make manifests; make install; make run
```{{exec}}

```shell
cp leaderelection  ../go/pkg/mod/github.com/spotahome/kooper/v2@v2.2.0/controller/leaderelection/leaderelection.go
```{{exec}}

```shell
go get k8s.io/client-go/tools/remotecommand@v0.30.0
go get k8s.io/apimachinery/pkg/util/httpstream/spdy@v0.30.0
go get k8s.io/apimachinery/pkg/util/proxy@v0.30.0
go mod tidy
```{{exec}}
